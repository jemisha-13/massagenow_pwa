import { __awaiter } from "tslib";
import { Component, Input, ViewChild, EventEmitter, Output } from '@angular/core';
import { from } from 'rxjs';
import { StripeElementsService } from '../services/stripe-elements.service';
import * as ɵngcc0 from '@angular/core';

const _c0 = ["stripeElementRef"];
export class StripePaymentRequestButtonComponent {
    constructor(stripeElementsService) {
        this.stripeElementsService = stripeElementsService;
        this.load = new EventEmitter();
        this.change = new EventEmitter();
        this.blur = new EventEmitter();
        this.focus = new EventEmitter();
        this.ready = new EventEmitter();
        this.token = new EventEmitter();
        this.paymentMethod = new EventEmitter();
        this.source = new EventEmitter();
        this.cancel = new EventEmitter();
        this.shippingaddresschange = new EventEmitter();
        this.shippingoptionchange = new EventEmitter();
        this.notavailable = new EventEmitter();
    }
    ngOnChanges(changes) {
        return __awaiter(this, void 0, void 0, function* () {
            const options = this.stripeElementsService.mergeOptions(this.options, this.containerClass);
            const elementsOptions = this.elementsOptions;
            const stripe = this.stripe;
            let updateElements = false;
            if (changes.elementsOptions || changes.stripe || !this.elements) {
                const elements = yield this.stripeElementsService
                    .elements(stripe, elementsOptions)
                    .toPromise();
                this.elements = elements;
                updateElements = true;
            }
            if (changes.paymentOptions && this.paymentRequest) {
                this.updateRequest(this.paymentOptions);
            }
            if (changes.options ||
                changes.containerClass ||
                !this.element ||
                updateElements) {
                if (this.element && !updateElements) {
                    this.update(options);
                }
                else if (this.elements && updateElements) {
                    this.paymentRequest = this.stripeElementsService.paymentRequest(stripe, this.paymentOptions);
                    this.paymentRequest.on('token', (ev) => this.token.emit(ev));
                    this.paymentRequest.on('paymentmethod', (ev) => this.paymentMethod.emit(ev));
                    this.paymentRequest.on('source', (ev) => this.source.emit(ev));
                    this.paymentRequest.on('cancel', () => this.cancel.emit());
                    this.paymentRequest.on('shippingaddresschange', (ev) => this.shippingaddresschange.emit(ev));
                    this.paymentRequest.on('shippingoptionchange', (ev) => this.shippingoptionchange.emit(ev));
                    this.element = this.elements.create('paymentRequestButton', Object.assign({ paymentRequest: this.paymentRequest }, options));
                    this.canMakePayment().subscribe((result) => {
                        if (result) {
                            this.element.on('click', (ev) => this.change.emit(ev));
                            this.element.on('blur', () => this.blur.emit());
                            this.element.on('focus', () => this.focus.emit());
                            this.element.on('ready', () => this.ready.emit());
                            this.element.mount(this.stripeElementRef.nativeElement);
                            this.load.emit({
                                paymentRequestButton: this.element,
                                paymentRequest: this.paymentRequest
                            });
                        }
                        else {
                            this.notavailable.emit();
                        }
                    });
                }
            }
        });
    }
    canMakePayment() {
        return from(this.paymentRequest.canMakePayment());
    }
    update(options) {
        this.element.update(options);
    }
    updateRequest(options) {
        this.paymentRequest.update(options);
    }
    show() {
        this.paymentRequest.show();
    }
    /**
     * @deprecated
     */
    getButton() {
        return this.element;
    }
}
StripePaymentRequestButtonComponent.ɵfac = function StripePaymentRequestButtonComponent_Factory(t) { return new (t || StripePaymentRequestButtonComponent)(ɵngcc0.ɵɵdirectiveInject(StripeElementsService)); };
StripePaymentRequestButtonComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: StripePaymentRequestButtonComponent, selectors: [["ngx-stripe-payment-request-button"]], viewQuery: function StripePaymentRequestButtonComponent_Query(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵviewQuery(_c0, true);
    } if (rf & 2) {
        var _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.stripeElementRef = _t.first);
    } }, inputs: { containerClass: "containerClass", paymentOptions: "paymentOptions", options: "options", elementsOptions: "elementsOptions", stripe: "stripe" }, outputs: { load: "load", change: "change", blur: "blur", focus: "focus", ready: "ready", token: "token", paymentMethod: "paymentMethod", source: "source", cancel: "cancel", shippingaddresschange: "shippingaddresschange", shippingoptionchange: "shippingoptionchange", notavailable: "notavailable" }, features: [ɵngcc0.ɵɵNgOnChangesFeature], decls: 2, vars: 0, consts: [[1, "field"], ["stripeElementRef", ""]], template: function StripePaymentRequestButtonComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelement(0, "div", 0, 1);
    } }, encapsulation: 2 });
StripePaymentRequestButtonComponent.ctorParameters = () => [
    { type: StripeElementsService }
];
StripePaymentRequestButtonComponent.propDecorators = {
    stripeElementRef: [{ type: ViewChild, args: ['stripeElementRef',] }],
    containerClass: [{ type: Input }],
    paymentOptions: [{ type: Input }],
    options: [{ type: Input }],
    elementsOptions: [{ type: Input }],
    stripe: [{ type: Input }],
    load: [{ type: Output }],
    change: [{ type: Output }],
    blur: [{ type: Output }],
    focus: [{ type: Output }],
    ready: [{ type: Output }],
    token: [{ type: Output }],
    paymentMethod: [{ type: Output }],
    source: [{ type: Output }],
    cancel: [{ type: Output }],
    shippingaddresschange: [{ type: Output }],
    shippingoptionchange: [{ type: Output }],
    notavailable: [{ type: Output }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(StripePaymentRequestButtonComponent, [{
        type: Component,
        args: [{
                selector: 'ngx-stripe-payment-request-button',
                template: `<div class="field" #stripeElementRef></div>`
            }]
    }], function () { return [{ type: StripeElementsService }]; }, { load: [{
            type: Output
        }], change: [{
            type: Output
        }], blur: [{
            type: Output
        }], focus: [{
            type: Output
        }], ready: [{
            type: Output
        }], token: [{
            type: Output
        }], paymentMethod: [{
            type: Output
        }], source: [{
            type: Output
        }], cancel: [{
            type: Output
        }], shippingaddresschange: [{
            type: Output
        }], shippingoptionchange: [{
            type: Output
        }], notavailable: [{
            type: Output
        }], stripeElementRef: [{
            type: ViewChild,
            args: ['stripeElementRef']
        }], containerClass: [{
            type: Input
        }], paymentOptions: [{
            type: Input
        }], options: [{
            type: Input
        }], elementsOptions: [{
            type: Input
        }], stripe: [{
            type: Input
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGF5bWVudC1yZXF1ZXN0LWJ1dHRvbi5jb21wb25lbnQuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL25neC1zdHJpcGUvc3JjL2xpYi9jb21wb25lbnRzL3BheW1lbnQtcmVxdWVzdC1idXR0b24uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUNULEtBQUssRUFDTCxTQUFTLEVBRVQsWUFBWSxFQUNaLE1BQU0sRUFHUCxNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQWMsSUFBSSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBb0J4QyxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSxxQ0FBcUMsQ0FBQzs7OztBQU01RSxNQUFNLE9BQU8sbUNBQW1DO0FBQUcsSUF1Q2pELFlBQW1CLHFCQUE0QztBQUFJLFFBQWhELDBCQUFxQixHQUFyQixxQkFBcUIsQ0FBdUI7QUFBQyxRQTVCdEQsU0FBSSxHQUFHLElBQUksWUFBWSxFQUc3QixDQUFDO0FBQ1AsUUFDWSxXQUFNLEdBQUcsSUFBSSxZQUFZLEVBRWhDLENBQUM7QUFDTixRQUFZLFNBQUksR0FBRyxJQUFJLFlBQVksRUFBUSxDQUFDO0FBQzVDLFFBQVksVUFBSyxHQUFHLElBQUksWUFBWSxFQUFRLENBQUM7QUFDN0MsUUFBWSxVQUFLLEdBQUcsSUFBSSxZQUFZLEVBQVEsQ0FBQztBQUM3QyxRQUNZLFVBQUssR0FBRyxJQUFJLFlBQVksRUFBNEIsQ0FBQztBQUNqRSxRQUFZLGtCQUFhLEdBQUcsSUFBSSxZQUFZLEVBRXZDLENBQUM7QUFDTixRQUFZLFdBQU0sR0FBRyxJQUFJLFlBQVksRUFBNkIsQ0FBQztBQUNuRSxRQUFZLFdBQU0sR0FBRyxJQUFJLFlBQVksRUFBUSxDQUFDO0FBQzlDLFFBQVksMEJBQXFCLEdBQUcsSUFBSSxZQUFZLEVBRS9DLENBQUM7QUFDTixRQUFZLHlCQUFvQixHQUFHLElBQUksWUFBWSxFQUU5QyxDQUFD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WCxNQUFNO0FBQUssbUJBR1gsTUFBTTtBQUFLLG9CQUNYLE1BQU07QUFBSyxvQkFDWCxNQUFNO0FBQUssb0JBRVgsTUFBTTtBQUFLLDRCQUNYLE1BQU07QUFBSyxxQkFHWCxNQUFNO0FBQUsscUJBQ1gsTUFBTTtBQUFLLG9DQUNYLE1BQU07QUFBSyxtQ0FHWCxNQUFNO0FBQUssMkJBR1gsTUFBTTtBQUFJOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztvQkFBRTtBQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQ29tcG9uZW50LFxuICBJbnB1dCxcbiAgVmlld0NoaWxkLFxuICBFbGVtZW50UmVmLFxuICBFdmVudEVtaXR0ZXIsXG4gIE91dHB1dCxcbiAgT25DaGFuZ2VzLFxuICBTaW1wbGVDaGFuZ2VzXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgZnJvbSB9IGZyb20gJ3J4anMnO1xuXG5pbXBvcnQge1xuICBTdHJpcGVFbGVtZW50c09wdGlvbnMsXG4gIFN0cmlwZUVsZW1lbnRzLFxuICBQYXltZW50UmVxdWVzdE9wdGlvbnMsXG4gIFBheW1lbnRSZXF1ZXN0LFxuICBDYW5NYWtlUGF5bWVudFJlc3VsdCxcbiAgUGF5bWVudFJlcXVlc3RVcGRhdGVPcHRpb25zLFxuICBTdHJpcGVQYXltZW50UmVxdWVzdEJ1dHRvbkVsZW1lbnQsXG4gIFN0cmlwZVBheW1lbnRSZXF1ZXN0QnV0dG9uRWxlbWVudE9wdGlvbnMsXG4gIFN0cmlwZVBheW1lbnRSZXF1ZXN0QnV0dG9uRWxlbWVudENsaWNrRXZlbnQsXG4gIFBheW1lbnRSZXF1ZXN0VG9rZW5FdmVudCxcbiAgUGF5bWVudFJlcXVlc3RQYXltZW50TWV0aG9kRXZlbnQsXG4gIFBheW1lbnRSZXF1ZXN0U291cmNlRXZlbnQsXG4gIFBheW1lbnRSZXF1ZXN0U2hpcHBpbmdBZGRyZXNzRXZlbnQsXG4gIFBheW1lbnRSZXF1ZXN0U2hpcHBpbmdPcHRpb25FdmVudFxufSBmcm9tICdAc3RyaXBlL3N0cmlwZS1qcyc7XG5cbmltcG9ydCB7IFN0cmlwZUluc3RhbmNlIH0gZnJvbSAnLi4vc2VydmljZXMvc3RyaXBlLWluc3RhbmNlLmNsYXNzJztcbmltcG9ydCB7IFN0cmlwZUVsZW1lbnRzU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL3N0cmlwZS1lbGVtZW50cy5zZXJ2aWNlJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnbmd4LXN0cmlwZS1wYXltZW50LXJlcXVlc3QtYnV0dG9uJyxcbiAgdGVtcGxhdGU6IGA8ZGl2IGNsYXNzPVwiZmllbGRcIiAjc3RyaXBlRWxlbWVudFJlZj48L2Rpdj5gXG59KVxuZXhwb3J0IGNsYXNzIFN0cmlwZVBheW1lbnRSZXF1ZXN0QnV0dG9uQ29tcG9uZW50IGltcGxlbWVudHMgT25DaGFuZ2VzIHtcbiAgQFZpZXdDaGlsZCgnc3RyaXBlRWxlbWVudFJlZicpIHB1YmxpYyBzdHJpcGVFbGVtZW50UmVmITogRWxlbWVudFJlZjtcbiAgZWxlbWVudCE6IFN0cmlwZVBheW1lbnRSZXF1ZXN0QnV0dG9uRWxlbWVudDtcbiAgcGF5bWVudFJlcXVlc3QhOiBQYXltZW50UmVxdWVzdDtcblxuICBASW5wdXQoKSBjb250YWluZXJDbGFzczogc3RyaW5nO1xuICBASW5wdXQoKSBwYXltZW50T3B0aW9uczogUGF5bWVudFJlcXVlc3RPcHRpb25zO1xuICBASW5wdXQoKSBvcHRpb25zOiBTdHJpcGVQYXltZW50UmVxdWVzdEJ1dHRvbkVsZW1lbnRPcHRpb25zO1xuICBASW5wdXQoKSBlbGVtZW50c09wdGlvbnM6IFBhcnRpYWw8U3RyaXBlRWxlbWVudHNPcHRpb25zPjtcbiAgQElucHV0KCkgc3RyaXBlOiBTdHJpcGVJbnN0YW5jZTtcblxuICBAT3V0cHV0KCkgbG9hZCA9IG5ldyBFdmVudEVtaXR0ZXI8e1xuICAgIHBheW1lbnRSZXF1ZXN0QnV0dG9uOiBTdHJpcGVQYXltZW50UmVxdWVzdEJ1dHRvbkVsZW1lbnQ7XG4gICAgcGF5bWVudFJlcXVlc3Q6IFBheW1lbnRSZXF1ZXN0O1xuICB9PigpO1xuXG4gIEBPdXRwdXQoKSBjaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyPFxuICAgIFN0cmlwZVBheW1lbnRSZXF1ZXN0QnV0dG9uRWxlbWVudENsaWNrRXZlbnRcbiAgPigpO1xuICBAT3V0cHV0KCkgYmx1ciA9IG5ldyBFdmVudEVtaXR0ZXI8dm9pZD4oKTtcbiAgQE91dHB1dCgpIGZvY3VzID0gbmV3IEV2ZW50RW1pdHRlcjx2b2lkPigpO1xuICBAT3V0cHV0KCkgcmVhZHkgPSBuZXcgRXZlbnRFbWl0dGVyPHZvaWQ+KCk7XG5cbiAgQE91dHB1dCgpIHRva2VuID0gbmV3IEV2ZW50RW1pdHRlcjxQYXltZW50UmVxdWVzdFRva2VuRXZlbnQ+KCk7XG4gIEBPdXRwdXQoKSBwYXltZW50TWV0aG9kID0gbmV3IEV2ZW50RW1pdHRlcjxcbiAgICBQYXltZW50UmVxdWVzdFBheW1lbnRNZXRob2RFdmVudFxuICA+KCk7XG4gIEBPdXRwdXQoKSBzb3VyY2UgPSBuZXcgRXZlbnRFbWl0dGVyPFBheW1lbnRSZXF1ZXN0U291cmNlRXZlbnQ+KCk7XG4gIEBPdXRwdXQoKSBjYW5jZWwgPSBuZXcgRXZlbnRFbWl0dGVyPHZvaWQ+KCk7XG4gIEBPdXRwdXQoKSBzaGlwcGluZ2FkZHJlc3NjaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyPFxuICAgIFBheW1lbnRSZXF1ZXN0U2hpcHBpbmdBZGRyZXNzRXZlbnRcbiAgPigpO1xuICBAT3V0cHV0KCkgc2hpcHBpbmdvcHRpb25jaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyPFxuICAgIFBheW1lbnRSZXF1ZXN0U2hpcHBpbmdPcHRpb25FdmVudFxuICA+KCk7XG4gIEBPdXRwdXQoKSBub3RhdmFpbGFibGUgPSBuZXcgRXZlbnRFbWl0dGVyPHZvaWQ+KCk7XG5cbiAgZWxlbWVudHM6IFN0cmlwZUVsZW1lbnRzO1xuXG4gIGNvbnN0cnVjdG9yKHB1YmxpYyBzdHJpcGVFbGVtZW50c1NlcnZpY2U6IFN0cmlwZUVsZW1lbnRzU2VydmljZSkge31cblxuICBhc3luYyBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XG4gICAgY29uc3Qgb3B0aW9ucyA9IHRoaXMuc3RyaXBlRWxlbWVudHNTZXJ2aWNlLm1lcmdlT3B0aW9ucyhcbiAgICAgIHRoaXMub3B0aW9ucyxcbiAgICAgIHRoaXMuY29udGFpbmVyQ2xhc3NcbiAgICApO1xuICAgIGNvbnN0IGVsZW1lbnRzT3B0aW9ucyA9IHRoaXMuZWxlbWVudHNPcHRpb25zO1xuICAgIGNvbnN0IHN0cmlwZSA9IHRoaXMuc3RyaXBlO1xuICAgIGxldCB1cGRhdGVFbGVtZW50cyA9IGZhbHNlO1xuXG4gICAgaWYgKGNoYW5nZXMuZWxlbWVudHNPcHRpb25zIHx8IGNoYW5nZXMuc3RyaXBlIHx8ICF0aGlzLmVsZW1lbnRzKSB7XG4gICAgICBjb25zdCBlbGVtZW50cyA9IGF3YWl0IHRoaXMuc3RyaXBlRWxlbWVudHNTZXJ2aWNlXG4gICAgICAgIC5lbGVtZW50cyhzdHJpcGUsIGVsZW1lbnRzT3B0aW9ucylcbiAgICAgICAgLnRvUHJvbWlzZSgpO1xuICAgICAgdGhpcy5lbGVtZW50cyA9IGVsZW1lbnRzO1xuICAgICAgdXBkYXRlRWxlbWVudHMgPSB0cnVlO1xuICAgIH1cblxuICAgIGlmIChjaGFuZ2VzLnBheW1lbnRPcHRpb25zICYmIHRoaXMucGF5bWVudFJlcXVlc3QpIHtcbiAgICAgIHRoaXMudXBkYXRlUmVxdWVzdCh0aGlzLnBheW1lbnRPcHRpb25zKTtcbiAgICB9XG5cbiAgICBpZiAoXG4gICAgICBjaGFuZ2VzLm9wdGlvbnMgfHxcbiAgICAgIGNoYW5nZXMuY29udGFpbmVyQ2xhc3MgfHxcbiAgICAgICF0aGlzLmVsZW1lbnQgfHxcbiAgICAgIHVwZGF0ZUVsZW1lbnRzXG4gICAgKSB7XG4gICAgICBpZiAodGhpcy5lbGVtZW50ICYmICF1cGRhdGVFbGVtZW50cykge1xuICAgICAgICB0aGlzLnVwZGF0ZShvcHRpb25zKTtcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5lbGVtZW50cyAmJiB1cGRhdGVFbGVtZW50cykge1xuICAgICAgICB0aGlzLnBheW1lbnRSZXF1ZXN0ID0gdGhpcy5zdHJpcGVFbGVtZW50c1NlcnZpY2UucGF5bWVudFJlcXVlc3QoXG4gICAgICAgICAgc3RyaXBlLFxuICAgICAgICAgIHRoaXMucGF5bWVudE9wdGlvbnNcbiAgICAgICAgKTtcbiAgICAgICAgdGhpcy5wYXltZW50UmVxdWVzdC5vbigndG9rZW4nLCAoZXYpID0+IHRoaXMudG9rZW4uZW1pdChldikpO1xuICAgICAgICB0aGlzLnBheW1lbnRSZXF1ZXN0Lm9uKCdwYXltZW50bWV0aG9kJywgKGV2KSA9PlxuICAgICAgICAgIHRoaXMucGF5bWVudE1ldGhvZC5lbWl0KGV2KVxuICAgICAgICApO1xuICAgICAgICB0aGlzLnBheW1lbnRSZXF1ZXN0Lm9uKCdzb3VyY2UnLCAoZXYpID0+IHRoaXMuc291cmNlLmVtaXQoZXYpKTtcbiAgICAgICAgdGhpcy5wYXltZW50UmVxdWVzdC5vbignY2FuY2VsJywgKCkgPT4gdGhpcy5jYW5jZWwuZW1pdCgpKTtcbiAgICAgICAgdGhpcy5wYXltZW50UmVxdWVzdC5vbignc2hpcHBpbmdhZGRyZXNzY2hhbmdlJywgKGV2KSA9PlxuICAgICAgICAgIHRoaXMuc2hpcHBpbmdhZGRyZXNzY2hhbmdlLmVtaXQoZXYpXG4gICAgICAgICk7XG4gICAgICAgIHRoaXMucGF5bWVudFJlcXVlc3Qub24oJ3NoaXBwaW5nb3B0aW9uY2hhbmdlJywgKGV2KSA9PlxuICAgICAgICAgIHRoaXMuc2hpcHBpbmdvcHRpb25jaGFuZ2UuZW1pdChldilcbiAgICAgICAgKTtcbiAgICAgICAgdGhpcy5lbGVtZW50ID0gdGhpcy5lbGVtZW50cy5jcmVhdGUoJ3BheW1lbnRSZXF1ZXN0QnV0dG9uJywge1xuICAgICAgICAgIHBheW1lbnRSZXF1ZXN0OiB0aGlzLnBheW1lbnRSZXF1ZXN0LFxuICAgICAgICAgIC4uLm9wdGlvbnNcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5jYW5NYWtlUGF5bWVudCgpLnN1YnNjcmliZSgocmVzdWx0KSA9PiB7XG4gICAgICAgICAgaWYgKHJlc3VsdCkge1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50Lm9uKCdjbGljaycsIChldikgPT4gdGhpcy5jaGFuZ2UuZW1pdChldikpO1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50Lm9uKCdibHVyJywgKCkgPT4gdGhpcy5ibHVyLmVtaXQoKSk7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQub24oJ2ZvY3VzJywgKCkgPT4gdGhpcy5mb2N1cy5lbWl0KCkpO1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50Lm9uKCdyZWFkeScsICgpID0+IHRoaXMucmVhZHkuZW1pdCgpKTtcblxuICAgICAgICAgICAgdGhpcy5lbGVtZW50Lm1vdW50KHRoaXMuc3RyaXBlRWxlbWVudFJlZi5uYXRpdmVFbGVtZW50KTtcblxuICAgICAgICAgICAgdGhpcy5sb2FkLmVtaXQoe1xuICAgICAgICAgICAgICBwYXltZW50UmVxdWVzdEJ1dHRvbjogdGhpcy5lbGVtZW50LFxuICAgICAgICAgICAgICBwYXltZW50UmVxdWVzdDogdGhpcy5wYXltZW50UmVxdWVzdFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubm90YXZhaWxhYmxlLmVtaXQoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGNhbk1ha2VQYXltZW50KCk6IE9ic2VydmFibGU8Q2FuTWFrZVBheW1lbnRSZXN1bHQgfCBudWxsPiB7XG4gICAgcmV0dXJuIGZyb20odGhpcy5wYXltZW50UmVxdWVzdC5jYW5NYWtlUGF5bWVudCgpKTtcbiAgfVxuXG4gIHVwZGF0ZShvcHRpb25zOiBQYXJ0aWFsPFN0cmlwZVBheW1lbnRSZXF1ZXN0QnV0dG9uRWxlbWVudE9wdGlvbnM+KSB7XG4gICAgdGhpcy5lbGVtZW50LnVwZGF0ZShvcHRpb25zKTtcbiAgfVxuXG4gIHVwZGF0ZVJlcXVlc3Qob3B0aW9uczogUGF5bWVudFJlcXVlc3RVcGRhdGVPcHRpb25zKSB7XG4gICAgdGhpcy5wYXltZW50UmVxdWVzdC51cGRhdGUob3B0aW9ucyk7XG4gIH1cblxuICBzaG93KCkge1xuICAgIHRoaXMucGF5bWVudFJlcXVlc3Quc2hvdygpO1xuICB9XG5cbiAgLyoqXG4gICAqIEBkZXByZWNhdGVkXG4gICAqL1xuICBnZXRCdXR0b24oKSB7XG4gICAgcmV0dXJuIHRoaXMuZWxlbWVudDtcbiAgfVxufVxuIl19